# صفحه مانیتورینگ فروش - گزارش کامل

## تاریخ: 1403/07/26

---

## ✅ آنچه ساخته شد:

### 1. API مانیتورینگ
**فایل:** `app/api/tenant/monitoring/route.ts`

**قابلیت‌ها:**
- ✅ فروش ماهانه (12 ماه اخیر)
- ✅ فروش هفتگی (8 هفته اخیر)
- ✅ وضعیت پرداخت (paid, pending, partial, refunded)
- ✅ برترین مشتریان (10 مشتری برتر بر اساس درآمد)
- ✅ رضایت مشتریان (میانگین، راضی، ناراضی)
- ✅ بازخوردها (توزیع امتیازات)
- ✅ فروشندگان برتر (5 فروشنده برتر)
- ✅ آمار کلی (کل فروش، درآمد، مشتریان، نرخ پرداخت)

**داده‌ها از دیتابیس:**
```sql
- جدول sales: فروش‌ها و درآمد
- جدول customers: مشتریان و رضایت
- جدول feedback: بازخوردها
```

---

### 2. صفحه مانیتورینگ
**فایل:** `app/[tenant_key]/dashboard/system-monitoring/page.tsx`

**ویژگی‌های رابط کاربری:**

#### 📊 کارت‌های آماری (4 کارت):
1. **کل درآمد** - با گرادیانت سبز
   - نمایش کل درآمد
   - تعداد کل فروش‌ها

2. **درآمد ماه جاری** - با گرادیانت آبی
   - درآمد 30 روز اخیر
   - تعداد فروش‌های ماه جاری

3. **کل مشتریان** - با گرادیانت بنفش
   - تعداد کل مشتریان
   - درصد رضایت

4. **نرخ پرداخت** - با گرادیانت زرد
   - درصد فروش‌های پرداخت شده
   - تعداد پرداخت شده از کل

#### 📈 نمودارها (5 تب):

##### تب 1: فروش
- **نمودار Area Chart** - روند فروش و درآمد
  - قابلیت تغییر بین نمایش هفتگی و ماهانه
  - دو محور Y برای فروش و درآمد
  - گرادیانت زیبا برای نمودار

- **نمودار Pie Chart** - وضعیت پرداخت
  - توزیع فروش‌ها بر اساس وضعیت پرداخت
  - رنگ‌های متمایز برای هر وضعیت

##### تب 2: مشتریان
- **نمودار Bar Chart افقی** - برترین مشتریان
  - 10 مشتری برتر بر اساس درآمد
  - نمایش تعداد فروش و درآمد
  - نام مشتریان در محور Y

##### تب 3: رضایت
- **3 کارت آماری:**
  1. مشتریان راضی (سبز)
  2. میانگین رضایت با ستاره‌ها (زرد)
  3. نیاز به بهبود (قرمز)

##### تب 4: بازخورد
- **نمودار Bar Chart** - توزیع بازخوردها
  - نمایش تعداد بازخوردها بر اساس امتیاز
  - رنگ بنفش

##### تب 5: فروشندگان
- **نمودار Bar Chart** - عملکرد فروشندگان
  - 5 فروشنده برتر
  - نمایش تعداد فروش و درآمد
  - دو محور Y

---

## 🎨 طراحی و رابط کاربری:

### رنگ‌بندی:
- **سبز:** درآمد، موفقیت، رضایت
- **آبی:** فروش، اطلاعات
- **بنفش:** مشتریان
- **زرد/نارنجی:** هشدار، میانگین
- **قرمز:** خطر، نیاز به بهبود

### انیمیشن‌ها:
- ✅ Fade-in برای کل صفحه
- ✅ Spin برای دکمه بروزرسانی
- ✅ Hover effects برای کارت‌ها
- ✅ Smooth transitions

### فونت:
- ✅ فونت Vazir برای تمام متن‌های فارسی
- ✅ اعداد فارسی با `toLocaleString('fa-IR')`

### Responsive:
- ✅ Grid responsive برای کارت‌ها
- ✅ نمودارها با ResponsiveContainer
- ✅ تب‌ها برای موبایل

---

## 📊 نمودارها (Recharts):

### استفاده شده:
1. **AreaChart** - روند فروش
2. **BarChart** - مقایسه‌ها
3. **PieChart** - توزیع
4. **LineChart** - روندها

### ویژگی‌ها:
- ✅ CartesianGrid برای شبکه
- ✅ Tooltip برای نمایش جزئیات
- ✅ Legend برای راهنما
- ✅ دو محور Y برای داده‌های مختلف
- ✅ گرادیانت برای زیبایی

---

## 🔧 قابلیت‌های اضافی:

### 1. فرمت اعداد:
```typescript
formatCurrency(value)
- میلیارد: 1,000,000,000+
- میلیون: 1,000,000+
- هزار: 1,000+
```

### 2. تبدیل تاریخ:
```typescript
formatMonth(monthStr)
- تبدیل تاریخ میلادی به شمسی
- نمایش نام ماه فارسی
```

### 3. دکمه بروزرسانی:
- ✅ Refresh icon با انیمیشن
- ✅ Disable در حین loading
- ✅ Toast notification برای خطاها

---

## 🚀 نحوه استفاده:

### 1. دسترسی:
```
http://localhost:3000/rabin/dashboard/system-monitoring
```

### 2. نیازمندی‌ها:
- ✅ Authentication (باید لاگین باشید)
- ✅ Tenant key (rabin)
- ✅ داده در دیتابیس

### 3. عملکرد:
1. صفحه لود می‌شود
2. API فراخوانی می‌شود
3. داده‌ها از دیتابیس خوانده می‌شوند
4. نمودارها رسم می‌شوند
5. کاربر می‌تواند بین تب‌ها جابجا شود
6. کاربر می‌تواند بین نمایش هفتگی/ماهانه تغییر دهد

---

## 📦 وابستگی‌ها:

### نصب شده:
- ✅ recharts@2.15.4
- ✅ moment-jalaali
- ✅ lucide-react

### استفاده شده:
```typescript
import { LineChart, BarChart, PieChart, AreaChart } from 'recharts';
import moment from 'moment-jalaali';
import { TrendingUp, DollarSign, Users, ... } from 'lucide-react';
```

---

## 🎯 نکات مهم:

### 1. عملکرد:
- ✅ Query های بهینه با GROUP BY
- ✅ محدودیت تعداد نتایج (LIMIT)
- ✅ استفاده از index ها (tenant_key)

### 2. امنیت:
- ✅ بررسی session
- ✅ فیلتر بر اساس tenant_key
- ✅ استفاده از prepared statements

### 3. UX:
- ✅ Loading state
- ✅ Error handling
- ✅ Toast notifications
- ✅ Responsive design

---

## 🐛 رفع مشکلات احتمالی:

### 1. نمودار نمایش داده نمی‌شود:
- چک کنید داده در دیتابیس وجود دارد
- Console را برای خطاها بررسی کنید
- Network tab را چک کنید

### 2. خطای 401:
- دوباره لاگین کنید
- Cookie ها را بررسی کنید

### 3. خطای 500:
- Connection pool را چک کنید
- MySQL را ریستارت کنید

---

## ✨ ویژگی‌های برجسته:

1. **داده واقعی از دیتابیس** - نه mock data
2. **نمودارهای تعاملی** - با Recharts
3. **طراحی مدرن** - با Tailwind و Gradients
4. **Responsive** - برای موبایل و دسکتاپ
5. **فارسی کامل** - با فونت Vazir و اعداد فارسی
6. **عملکرد بالا** - با query های بهینه
7. **تجربه کاربری عالی** - با انیمیشن و transitions

---

## 🎉 نتیجه:

یک صفحه مانیتورینگ حرفه‌ای با:
- ✅ 4 کارت آماری
- ✅ 5 تب مختلف
- ✅ 7 نمودار متنوع
- ✅ داده واقعی از دیتابیس
- ✅ طراحی زیبا و مدرن
- ✅ تجربه کاربری عالی

**آماده استفاده است!** 🚀
