# ุฑูุน ูุดฺฉู ุงูุฒูุฏู ููฺฉุงุฑ

## ุชุงุฑุฎ: 1403/07/26 - ุณุงุนุช 21:00

---

## โ ูุดฺฉูุงุช:

### 1. ุฎุทุง customers-simple API
```
Error: Unknown column 'company' in 'field list'
```

**ุนูุช:** ุฌุฏูู customers ุณุชูู `company` ูุฏุงุฑุฏุ ุจุงุฏ ุงุฒ `company_name` ุงุณุชูุงุฏู ฺฉุฑุฏ.

### 2. API ุงูุฒูุฏู ููฺฉุงุฑ ูุฌูุฏ ูุฏุงุดุช
```
POST /api/tenant/users
```

**ุนูุช:** ูุงู `app/api/tenant/users/route.ts` ูุฌูุฏ ูุฏุงุดุช.

---

## โ ุฑุงู ุญูโูุง:

### 1. ูฺฉุณ customers-simple API

**ูุงู:** `app/api/tenant/customers-simple/route.ts`

```typescript
// ูุจู:
SELECT id, name, email, phone, company 
FROM customers

// ุจุนุฏ:
SELECT id, name, email, phone, company_name as company 
FROM customers
```

---

### 2. ุณุงุฎุช API ุงูุฒูุฏู ููฺฉุงุฑ

**ูุงู:** `app/api/tenant/users/route.ts`

**ูุงุจูุชโูุง:**
- โ ุจุฑุฑุณ ุงุญุฑุงุฒ ููุช
- โ ุจุฑุฑุณ ูุฌูุฒ (ููุท ceo, admin, ูุฏุฑ)
- โ Validation ูุฑูุฏโูุง
- โ ุจุฑุฑุณ ุชฺฉุฑุงุฑ ูุจูุฏู ุงูู
- โ Hash ฺฉุฑุฏู ุฑูุฒ ุนุจูุฑ ุจุง bcrypt
- โ ุซุจุช ฺฉุงุฑุจุฑ ุฌุฏุฏ ุฏุฑ ุฏุชุงุจุณ

**ููุฏูุง ุงูุฒุงู:**
- name (ูุงู ฺฉุงูู)
- email (ุงูู)
- password (ุฑูุฒ ุนุจูุฑ)

**ููุฏูุง ุงุฎุชุงุฑ:**
- role (ููุด - ูพุดโูุฑุถ: sales_agent)
- phone (ุชููู)

**ููุดโูุง ูุฌุงุฒ:**
- sales_agent (ููุงูุฏู ูุฑูุด)
- agent (ููุงูุฏู)
- sales_manager (ูุฏุฑ ูุฑูุด)

---

## ๐ ูุญูู ฺฉุงุฑ:

### 1. ฺฉุงุฑุจุฑ ูุฑู ุฑุง ูพุฑ ูโฺฉูุฏ:
```typescript
{
  name: "ุงุญูุฏ ุฑุถุง",
  email: "ahmad@example.com",
  password: "123456",
  role: "sales_agent",
  phone: "09123456789"
}
```

### 2. ุฏุฑุฎูุงุณุช ุจู API ุงุฑุณุงู ูโุดูุฏ:
```typescript
POST /api/tenant/users
Headers:
  - X-Tenant-Key: rabin
  - Authorization: Bearer {token}
  - Content-Type: application/json
```

### 3. API ุจุฑุฑุณโูุง ุฑุง ุงูุฌุงู ูโุฏูุฏ:
- โ Tenant key ูุนุชุจุฑ ุงุณุชุ
- โ ฺฉุงุฑุจุฑ ูุงฺฏู ุงุณุชุ
- โ ฺฉุงุฑุจุฑ ูุฌูุฒ ุฏุงุฑุฏุ
- โ ููุฏูุง ุงูุฒุงู ูพุฑ ุดุฏูโุงูุฏุ
- โ ุงูู ุชฺฉุฑุงุฑ ูุณุชุ

### 4. ุฑูุฒ ุนุจูุฑ hash ูโุดูุฏ:
```typescript
const hashedPassword = await bcrypt.hash(password, 10);
```

### 5. ฺฉุงุฑุจุฑ ุฏุฑ ุฏุชุงุจุณ ุซุจุช ูโุดูุฏ:
```sql
INSERT INTO users (
  id, tenant_key, name, email, password, role, phone, 
  status, created_at, updated_at
) VALUES (UUID(), ?, ?, ?, ?, ?, ?, 'active', NOW(), NOW())
```

### 6. ูพุงุณุฎ ููููุช ุจุฑูโฺฏุฑุฏุฏ:
```json
{
  "success": true,
  "message": "ููฺฉุงุฑ ุจุง ููููุช ุงุถุงูู ุดุฏ",
  "data": {
    "id": "...",
    "name": "ุงุญูุฏ ุฑุถุง",
    "email": "ahmad@example.com",
    "role": "sales_agent"
  }
}
```

---

## ๐ ุงููุช:

### 1. ุงุญุฑุงุฒ ููุช:
- ุจุฑุฑุณ session
- ุจุฑุฑุณ token

### 2. ูุฌูุฒุฏู:
- ููุท ceo, admin, ูุฏุฑ ูโุชูุงููุฏ ููฺฉุงุฑ ุงุถุงูู ฺฉููุฏ

### 3. Validation:
- ุจุฑุฑุณ ููุฏูุง ุงูุฒุงู
- ุจุฑุฑุณ ูุฑูุช ุงูู
- ุจุฑุฑุณ ุชฺฉุฑุงุฑ ูุจูุฏู ุงูู

### 4. ุฑูุฒ ุนุจูุฑ:
- Hash ุดุฏู ุจุง bcrypt
- Salt rounds: 10

---

## ๐งช ุชุณุช:

### 1. ุชุณุช ูููู:
```bash
# ุฏุฑุฎูุงุณุช
POST /api/tenant/users
{
  "name": "ุชุณุช ฺฉุงุฑุจุฑ",
  "email": "test@example.com",
  "password": "123456",
  "role": "sales_agent"
}

# ูพุงุณุฎ
{
  "success": true,
  "message": "ููฺฉุงุฑ ุจุง ููููุช ุงุถุงูู ุดุฏ"
}
```

### 2. ุชุณุช ุงูู ุชฺฉุฑุงุฑ:
```bash
# ูพุงุณุฎ
{
  "success": false,
  "message": "ุงู ุงูู ูุจูุงู ุซุจุช ุดุฏู ุงุณุช"
}
```

### 3. ุชุณุช ุจุฏูู ูุฌูุฒ:
```bash
# ูพุงุณุฎ
{
  "success": false,
  "message": "ุดูุง ูุฌูุฒ ุงูุฒูุฏู ููฺฉุงุฑ ูุฏุงุฑุฏ"
}
```

### 4. ุชุณุช ููุฏ ุฎุงู:
```bash
# ูพุงุณุฎ
{
  "success": false,
  "message": "ูุงูุ ุงูู ู ุฑูุฒ ุนุจูุฑ ุงูุฒุงู ุงุณุช"
}
```

---

## ๐ ูฺฉุงุช ููู:

### 1. ุฑูุฒ ุนุจูุฑ:
- ุญุฏุงูู 6 ฺฉุงุฑุงฺฉุชุฑ ุชูุตู ูโุดูุฏ
- Hash ูโุดูุฏ ูุจู ุงุฒ ุฐุฎุฑู
- ูุฑฺฏุฒ plain text ุฐุฎุฑู ููโุดูุฏ

### 2. ููุดโูุง:
- ูพุดโูุฑุถ: sales_agent
- ูุงุจู ุชุบุฑ ุชูุณุท admin

### 3. ูุถุนุช:
- ูพุดโูุฑุถ: active
- ูโุชูุงูุฏ inactive ุดูุฏ

### 4. Tenant Isolation:
- ูุฑ ฺฉุงุฑุจุฑ ุจู ฺฉ tenant ุชุนูู ุฏุงุฑุฏ
- tenant_key ุฏุฑ ุชูุงู query ูุง ุงุณุชูุงุฏู ูโุดูุฏ

---

## โ ฺฺฉ ูุณุช:

- [x] API customers-simple ูฺฉุณ ุดุฏ
- [x] API ุงูุฒูุฏู ููฺฉุงุฑ ุณุงุฎุชู ุดุฏ
- [x] ุงุญุฑุงุฒ ููุช ูพุงุฏู ุดุฏ
- [x] ูุฌูุฒุฏู ูพุงุฏู ุดุฏ
- [x] Validation ูพุงุฏู ุดุฏ
- [x] Hash ุฑูุฒ ุนุจูุฑ ูพุงุฏู ุดุฏ
- [x] ุจุฑุฑุณ ุงูู ุชฺฉุฑุงุฑ ูพุงุฏู ุดุฏ
- [x] Tenant isolation ูพุงุฏู ุดุฏ

---

## ๐ ูุชุฌู:

**ููู ูุดฺฉูุงุช ุจุฑุทุฑู ุดุฏ!**

1. โ API customers-simple ฺฉุงุฑ ูโฺฉูุฏ
2. โ ุงูุฒูุฏู ููฺฉุงุฑ ฺฉุงุฑ ูโฺฉูุฏ
3. โ ุงููุช ุฑุนุงุช ุดุฏู
4. โ Validation ุงูุฌุงู ูโุดูุฏ

**ููฺฉ:** `http://localhost:3000/rabin/dashboard/coworkers`

๐ **ุขูุงุฏู ุงุณุชูุงุฏู!**
