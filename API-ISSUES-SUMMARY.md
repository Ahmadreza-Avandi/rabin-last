# ุฎูุงุตู ูุดฺฉูุงุช APIูุง ุณุณุชู CRM

## ๐ด ูุดฺฉูุงุช ููุฑ (ูุงุฒ ุจู ุฑูุน ุณุฑุน)

### 1. ุนููฺฉุฑุฏ ุจุณุงุฑ ฺฉูุฏ Login API
**ูุดฺฉู:** ุฒูุงู ูพุงุณุฎ 12.6 ุซุงูู (ุจุงุฏ ฺฉูุชุฑ ุงุฒ 2 ุซุงูู ุจุงุดุฏ)
**ุชุงุซุฑ:** ุชุฌุฑุจู ฺฉุงุฑุจุฑ ุจุณุงุฑ ุถุนูุ ฺฉุงุฑุจุฑุงู ููโุชูุงููุฏ ุณุฑุน ูุงุฑุฏ ุณุณุชู ุดููุฏ
**ุนูุช ุงุญุชูุงู:**
- bcrypt rounds ุจุด ุงุฒ ุญุฏ (ุงุญุชูุงูุงู 12-14)
- query ุฏุชุงุจุณ ุจููู ูุดุฏู
- ุนุฏู ุงุณุชูุงุฏู ุงุฒ caching
**ุฑุงู ุญู ูพุดููุงุฏ:**
```typescript
// ฺฉุงูุด bcrypt rounds ุจู 10
const hashedPassword = await bcrypt.hash(password, 10);

// ุงุถุงูู ฺฉุฑุฏู index ุจู ุฌุฏูู users
CREATE INDEX idx_users_email ON users(email);

// ุงุณุชูุงุฏู ุงุฒ connection pooling
```

### 2. Health Check API ุฎุฑุงุจ ุงุณุช
**ูุดฺฉู:** ุฎุทุง 500 ู ุฒูุงู ูพุงุณุฎ 3.5 ุซุงูู
**ุชุงุซุฑ:** ููโุชูุงู ุณูุงูุช ุณุณุชู ุฑุง ูุงูุชูุฑ ฺฉุฑุฏ
**ุนูุช ุงุญุชูุงู:**
- ูุดฺฉู ุฏุฑ ุงุชุตุงู ุจู ุฏุชุงุจุณ
- ุงุณุชูุงุฏู ุงุฒ environment variables ูุงุฏุฑุณุช
**ุฑุงู ุญู ูพุดููุงุฏ:**
```typescript
// ุจุฑุฑุณ ูุชุบุฑูุง ูุญุท
console.log('DB Config:', {
  host: process.env.DB_HOST,
  user: process.env.DB_USER,
  database: process.env.DB_NAME
});

// ุงุณุชูุงุฏู ุงุฒ timeout
const connection = await mysql.createConnection({
  ...config,
  connectTimeout: 5000
});
```

### 3. APIูุง ูพูู ูุฏุฑุช ฺฉุงุฑ ููโฺฉููุฏ
**ูุดฺฉู:** ุชูุงู APIูุง `/api/admin/*` ุฎุทุง 401 ูโุฏููุฏ
**ุชุงุซุฑ:** ูุฏุฑุงู ููโุชูุงููุฏ ุจู ูพูู ูุฏุฑุช ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดูุฏ
**APIูุง ุชุงุซุฑ ฺฏุฑูุชู:**
- `GET /api/admin/stats`
- `GET /api/admin/tenants`
**ุนูุช ุงุญุชูุงู:**
- ูุงุฒ ุจู ุงุญุฑุงุฒ ููุช ุฌุฏุงฺฏุงูู ุจุฑุง admin
- ูุงุฒ ุจู role check
**ุฑุงู ุญู ูพุดููุงุฏ:**
```typescript
// ุงุถุงูู ฺฉุฑุฏู admin middleware
export async function GET(req: NextRequest) {
  const user = await getCurrentUser(req);
  
  if (!user || user.role !== 'admin') {
    return NextResponse.json(
      { success: false, message: 'ุฏุณุชุฑุณ ุบุฑูุฌุงุฒ' },
      { status: 403 }
    );
  }
  // ...
}
```

## ๐ก ูุดฺฉูุงุช ูุชูุณุท (ูุงุฒ ุจู ุฑูุน ุฏุฑ ุงูููุช ุจุนุฏ)

### 4. ููุชุฑ ูุถุนุช ุฏุฑ Tasks ฺฉุงุฑ ููโฺฉูุฏ
**ูุดฺฉู:** `GET /api/tasks?status=pending` ุฎุทุง 500 ูโุฏูุฏ
**ุชุงุซุฑ:** ฺฉุงุฑุจุฑุงู ููโุชูุงููุฏ ูุธุงู ุฑุง ุจุฑ ุงุณุงุณ ูุถุนุช ููุชุฑ ฺฉููุฏ
**ุนูุช ุงุญุชูุงู:**
- ููุฏุงุฑ status ูุงูุนุชุจุฑ ุฏุฑ ุฏุชุงุจุณ
- enum ุฏุฑ ุฌุฏูู tasks ุจุง ููุฏุงุฑ ุงุฑุณุงู ูุทุงุจูุช ูุฏุงุฑุฏ
**ุฑุงู ุญู ูพุดููุงุฏ:**
```sql
-- ุจุฑุฑุณ enum ูุง ููุฌูุฏ
SHOW COLUMNS FROM tasks LIKE 'status';

-- ุงุตูุงุญ query ุจุฑุง handle ฺฉุฑุฏู ููุงุฏุฑ ูุงูุนุชุจุฑ
WHERE (status = ? OR ? = '')
```

### 5. ุฌุณุชุฌู ุนููู (Global Search) ฺฉุงุฑ ููโฺฉูุฏ
**ูุดฺฉู:** `GET /api/search?q=test` ุฎุทุง 500 ูโุฏูุฏ
**ุชุงุซุฑ:** ฺฉุงุฑุจุฑุงู ููโุชูุงููุฏ ุฏุฑ ฺฉู ุณุณุชู ุฌุณุชุฌู ฺฉููุฏ
**ุฑุงู ุญู ูพุดููุงุฏ:**
- ุจุฑุฑุณ ูุงฺฏโูุง ุณุฑูุฑ ุจุฑุง ุงูุชู ุนูุช ุฏูู
- ุงุถุงูู ฺฉุฑุฏู try-catch ุจู ูุฑ ุจุฎุด ุฌุณุชุฌู
- ุงุณุชูุงุฏู ุงุฒ FULLTEXT index ุจุฑุง ุจูุจูุฏ ุนููฺฉุฑุฏ

### 6. APIูุง Tenant ฺฉุงุฑ ููโฺฉููุฏ
**ูุดฺฉู:** ุชูุงู APIูุง `/api/tenant/*` ุฎุทุง 401 ุง 400 ูโุฏููุฏ
**APIูุง ุชุงุซุฑ ฺฏุฑูุชู:**
- `GET /api/tenant/info` (400 - tenant_key required)
- `GET /api/tenant/dashboard` (401)
- `GET /api/tenant/customers` (401)
**ุนูุช ุงุญุชูุงู:**
- ูุงุฒ ุจู ุงุฑุณุงู `x-tenant-key` ุฏุฑ header
- ูุงุฒ ุจู ุงุญุฑุงุฒ ููุช ุฎุงุต tenant
**ุฑุงู ุญู ูพุดููุงุฏ:**
```typescript
// ุงุถุงูู ฺฉุฑุฏู tenant middleware
const tenantKey = req.headers.get('x-tenant-key');
if (!tenantKey) {
  return NextResponse.json(
    { success: false, message: 'tenant_key is required' },
    { status: 400 }
  );
}
```

### 7. Reports Today API ูุดฺฉู ุงุญุฑุงุฒ ููุช ุฏุงุฑุฏ
**ูุดฺฉู:** `GET /api/reports/today` ุฎุทุง 401 ูโุฏูุฏ
**ุชุงุซุฑ:** ฺฉุงุฑุจุฑุงู ููโุชูุงููุฏ ฺฏุฒุงุฑุด ุงูุฑูุฒ ุฑุง ุจุจููุฏ
**ุฑุงู ุญู ูพุดููุงุฏ:**
- ุจุฑุฑุณ ูุงุฒููุฏโูุง ุฏุณุชุฑุณ
- ููุณุงูโุณุงุฒ ุจุง API ุงุตู reports ฺฉู ฺฉุงุฑ ูโฺฉูุฏ

### 8. Permissions API ุงุตู ฺฉุงุฑ ููโฺฉูุฏ
**ูุดฺฉู:** `GET /api/permissions` ุฎุทุง 401 ูโุฏูุฏ (ุงูุง `/api/permissions/modules` ฺฉุงุฑ ูโฺฉูุฏ)
**ุฑุงู ุญู ูพุดููุงุฏ:**
- ุจุฑุฑุณ ุชูุงูุช ุงุญุฑุงุฒ ููุช ุจู ุฏู endpoint
- ููุณุงูโุณุงุฒ ูฺฉุงูุฒู auth

### 9. System Stats API ุฎุฑุงุจ ุงุณุช
**ูุดฺฉู:** `GET /api/settings/system-stats` ุฎุทุง 500 ูโุฏูุฏ
**ุชุงุซุฑ:** ููโุชูุงู ุขูุงุฑ ุณุณุชู ุฑุง ูุดุงูุฏู ฺฉุฑุฏ
**ุฑุงู ุญู ูพุดููุงุฏ:**
- ุจุฑุฑุณ query ูุง ุขูุงุฑ
- ุงุถุงูู ฺฉุฑุฏู error handling ุจูุชุฑ

## ๐ ุขูุงุฑ ฺฉู ูุดฺฉูุงุช

| ููุน ูุดฺฉู | ุชุนุฏุงุฏ | ุฏุฑุตุฏ |
|----------|-------|------|
| ุฎุทุง 500 (Server Error) | 5 | 45.5% |
| ุฎุทุง 401 (Unauthorized) | 5 | 45.5% |
| ุฎุทุง 400 (Bad Request) | 1 | 9% |

## ๐ฏ ุงูุฏุงูุงุช ูพุดููุงุฏ ุจู ุชุฑุชุจ ุงูููุช

### ูุงุฒ 1: ุฑูุน ูุดฺฉูุงุช ููุฑ (1-2 ุฑูุฒ)
1. โ ุจูููโุณุงุฒ Login API (ฺฉุงูุด ุฒูุงู ูพุงุณุฎ)
2. โ ุฑูุน Health Check API
3. โ ุฑูุน ุงุญุฑุงุฒ ููุช Admin APIs

### ูุงุฒ 2: ุฑูุน ูุดฺฉูุงุช ูุชูุณุท (3-5 ุฑูุฒ)
4. โ ุฑูุน ููุชุฑ Tasks
5. โ ุฑูุน Global Search
6. โ ุฑูุน Tenant APIs
7. โ ุฑูุน Reports Today
8. โ ุฑูุน Permissions API
9. โ ุฑูุน System Stats

### ูุงุฒ 3: ุจูุจูุฏ ู ุชุณุช (2-3 ุฑูุฒ)
10. โ ุงุถุงูู ฺฉุฑุฏู ุชุณุชโูุง ุฌุงูุนโุชุฑ
11. โ ุงุถุงูู ฺฉุฑุฏู monitoring ู logging
12. โ ุจูููโุณุงุฒ performance ฺฉู
13. โ ูุณุชูุฏุณุงุฒ APIูุง

## ๐ ูฺฉุงุช ููู ุจุฑุง ุชูุณุนูโุฏููุฏฺฏุงู

### 1. ุงุณุชุงูุฏุงุฑุฏุณุงุฒ Error Handling
```typescript
// ุงูฺฏู ูพุดููุงุฏ
try {
  // API logic
} catch (error) {
  console.error('API Error:', error);
  return NextResponse.json(
    { 
      success: false, 
      message: 'ูพุงู ูุงุฑุณ ููุงุณุจ',
      error: process.env.NODE_ENV === 'development' ? error.message : undefined
    },
    { status: 500 }
  );
}
```

### 2. ุงุณุชุงูุฏุงุฑุฏุณุงุฒ Authentication
```typescript
// ููู APIูุง ุจุงุฏ ุงุฒ ุงู ุงูฺฏู ุงุณุชูุงุฏู ฺฉููุฏ
const user = await getCurrentUser(req);
if (!user) {
  return NextResponse.json(
    { success: false, message: 'ุชูฺฉู ูุงูุนุชุจุฑ ุงุณุช' },
    { status: 401 }
  );
}
```

### 3. ุงุณุชุงูุฏุงุฑุฏุณุงุฒ Response Format
```typescript
// ูููู
{ success: true, data: [...] }

// ูุงูููู
{ success: false, message: 'ูพุงู ุฎุทุง' }
```

### 4. ุงุถุงูู ฺฉุฑุฏู Logging
```typescript
console.log(`[${new Date().toISOString()}] ${req.method} ${req.url}`);
console.log('User:', user?.email);
console.log('Params:', params);
```

## ๐ ฺฺฉโูุณุช ุชุณุช ุจุฑุง ูุฑ API

- [ ] ุชุณุช ุจุง ุงุญุฑุงุฒ ููุช ูุนุชุจุฑ
- [ ] ุชุณุช ุจุฏูู ุงุญุฑุงุฒ ููุช (ุงูุชุธุงุฑ 401)
- [ ] ุชุณุช ุจุง ุฏุงุฏูโูุง ูุนุชุจุฑ
- [ ] ุชุณุช ุจุง ุฏุงุฏูโูุง ูุงูุนุชุจุฑ (ุงูุชุธุงุฑ 400)
- [ ] ุชุณุช pagination
- [ ] ุชุณุช ููุชุฑูุง
- [ ] ุชุณุช sorting
- [ ] ุจุฑุฑุณ ุฒูุงู ูพุงุณุฎ (ุจุงุฏ < 2 ุซุงูู)
- [ ] ุจุฑุฑุณ format ูพุงุณุฎ
- [ ] ุชุณุช error handling

## ๐ ูุชุฌูโฺฏุฑ

ุณุณุชู ุฏุฑ ุญุงู ุญุงุถุฑ **73.2% ููููุช** ุฏุงุฑุฏ ฺฉู ูุดุงูโุฏููุฏู ฺฉ ูพุงู ุฎูุจ ุงุณุช. ุจุง ุฑูุน 11 ูุดฺฉู ุดูุงุณุง ุดุฏูุ ูโุชูุงู ุจู **100% ููููุช** ุฑุณุฏ.

**ูููโุชุฑู ุงูุฏุงูุงุช:**
1. ๐ด ุจูููโุณุงุฒ Login (ุชุงุซุฑ ุจุฑ ุชูุงู ฺฉุงุฑุจุฑุงู)
2. ๐ด ุฑูุน Admin APIs (ุชุงุซุฑ ุจุฑ ูุฏุฑุงู)
3. ๐ก ุฑูุน Tenant APIs (ุชุงุซุฑ ุจุฑ ูุนูุงุฑ multi-tenant)

**ุฒูุงู ุชุฎูู ฺฉู:** 6-10 ุฑูุฒ ฺฉุงุฑ
**ููุงุจุน ููุฑุฏ ูุงุฒ:** 1-2 ุชูุณุนูโุฏููุฏู Backend

---

**ุชุงุฑุฎ:** 2025-01-15
**ูุถุนุช:** ูุงุฒ ุจู ุงูุฏุงู ููุฑ
