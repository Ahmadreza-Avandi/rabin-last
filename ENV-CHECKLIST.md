# ✅ چک‌لیست یکپارچه‌سازی ENV

## 📋 قبل از شروع

- [ ] پشتیبان از پروژه گرفته‌اید
- [ ] فایل‌های `.env` فعلی را بررسی کرده‌اید
- [ ] Git Bash یا WSL نصب است (برای Windows)

## 🚀 مراحل اجرا

### مرحله 1: آماده‌سازی
- [ ] فایل `.env.unified` را بررسی کنید
- [ ] اطمینان حاصل کنید که تمام تنظیمات صحیح است
- [ ] رمزهای عبور را بررسی کنید

### مرحله 2: اجرای اسکریپت
```bash
bash unify-env-files.sh
```
- [ ] اسکریپت بدون خطا اجرا شد
- [ ] پیام موفقیت نمایش داده شد
- [ ] فولدر backup ایجاد شد

### مرحله 3: بررسی فایل‌ها
- [ ] فایل `.env` ایجاد شد
- [ ] فایل `.env.local` ایجاد شد
- [ ] فایل `.env.server` ایجاد شد
- [ ] فایل‌های backup در `env_backup_*` هستند

### مرحله 4: تست Development
```bash
npm run dev
```
- [ ] سرور بدون خطا راه‌اندازی شد
- [ ] به دیتابیس متصل شد
- [ ] صفحه لاگین باز می‌شود
- [ ] لاگین کار می‌کند

### مرحله 5: تست Production Build
```bash
npm run build
```
- [ ] Build بدون خطا انجام شد
- [ ] هیچ warning مهمی نیست
- [ ] فایل‌های build ایجاد شدند

### مرحله 6: تست Docker
```bash
docker-compose up --build
```
- [ ] تمام کانتینرها build شدند
- [ ] MySQL راه‌اندازی شد
- [ ] Next.js راه‌اندازی شد
- [ ] Rabin Voice راه‌اندازی شد
- [ ] Nginx راه‌اندازی شد

### مرحله 7: تست عملکرد

#### Next.js CRM
- [ ] صفحه اصلی باز می‌شود
- [ ] لاگین کار می‌کند
- [ ] داشبورد نمایش داده می‌شود
- [ ] API ها کار می‌کنند

#### SaaS Admin Panel
- [ ] `/secret-zone-789/admin-panel` باز می‌شود
- [ ] لاگین ادمین کار می‌کند
- [ ] لیست tenants نمایش داده می‌شود
- [ ] ایجاد tenant جدید کار می‌کند

#### Rabin Voice
- [ ] `/rabin-voice` باز می‌شود
- [ ] صفحه لود می‌شود
- [ ] به دیتابیس متصل است
- [ ] API های AI کار می‌کنند

## 🔍 بررسی متغیرهای محیطی

### دیتابیس
- [ ] `DATABASE_HOST` صحیح است
- [ ] `DATABASE_USER` صحیح است
- [ ] `DATABASE_PASSWORD` صحیح است
- [ ] `DATABASE_NAME` صحیح است
- [ ] `MASTER_DB_HOST` صحیح است

### Rabin Voice
- [ ] `RABIN_VOICE_OPENROUTER_API_KEY` تنظیم شده
- [ ] `RABIN_VOICE_OPENROUTER_MODEL` صحیح است
- [ ] `RABIN_VOICE_TTS_API_URL` صحیح است

### Email
- [ ] `EMAIL_HOST` صحیح است
- [ ] `EMAIL_USER` صحیح است
- [ ] `EMAIL_PASS` صحیح است

### Security
- [ ] `JWT_SECRET` تنظیم شده
- [ ] `NEXTAUTH_SECRET` تنظیم شده
- [ ] `DB_ENCRYPTION_KEY` تنظیم شده

## 🐛 عیب‌یابی

اگر مشکلی پیش آمد:

### مشکل: اسکریپت اجرا نمی‌شود
- [ ] Git Bash یا WSL نصب کردید
- [ ] دسترسی اجرا دارید: `chmod +x unify-env-files.sh`
- [ ] در مسیر صحیح هستید

### مشکل: متغیر خوانده نمی‌شود
- [ ] فایل `.env` وجود دارد
- [ ] متغیر در فایل تعریف شده
- [ ] سرور را restart کردید
- [ ] cache را پاک کردید

### مشکل: Docker متصل نمی‌شود
- [ ] فایل `.env.server` وجود دارد
- [ ] `docker-compose.yml` به `.env` اشاره می‌کند
- [ ] کانتینرها را rebuild کردید
- [ ] network مشکل ندارد

### مشکل: Rabin Voice کار نمی‌کند
- [ ] API Key صحیح است
- [ ] به دیتابیس متصل است
- [ ] لاگ‌ها را بررسی کردید: `docker logs crm-rabin-voice`
- [ ] متغیرهای محیطی را چک کردید

## 📊 تست نهایی

### Development (localhost)
```bash
# تست کامل
npm run dev
# باز کردن: http://localhost:3000
```
- [ ] ✅ کار می‌کند

### Production (Docker)
```bash
# تست کامل
docker-compose up --build
# باز کردن: http://crm.robintejarat.com
```
- [ ] ✅ کار می‌کند

### Deployment (Server)
```bash
# تست کامل
./deploy-server.sh
```
- [ ] ✅ کار می‌کند

## 🎉 تکمیل

اگر همه موارد بالا ✅ هستند:

- [ ] ✅ یکپارچه‌سازی موفق بود
- [ ] ✅ تمام ماژول‌ها کار می‌کنند
- [ ] ✅ فایل‌های backup ذخیره شدند
- [ ] ✅ مستندات خوانده شد

## 📝 یادداشت‌ها

تاریخ اجرا: _______________

مشکلات پیش آمده:
- 
- 
- 

راه‌حل‌ها:
- 
- 
- 

## 🔄 مراحل بعدی

- [ ] فایل‌های `.env` را در `.gitignore` قرار دهید
- [ ] رمزهای عبور را در production تغییر دهید
- [ ] backup منظم از تنظیمات بگیرید
- [ ] مستندات را به‌روز نگه دارید

---

**✨ تبریک! یکپارچه‌سازی کامل شد!**
