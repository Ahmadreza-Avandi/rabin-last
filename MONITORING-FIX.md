# ุฑูุน ูุดฺฉู ุตูุญู ูุงูุชูุฑูฺฏ

## ุชุงุฑุฎ: 1403/07/26

---

## ูุดฺฉูุงุช ุงูุช ุดุฏู:

### โ 1. ุฌุฏูู feedback - ุณุชูู rating
**ุฎุทุง:** `Unknown column 'rating' in 'field list'`
**ุนูุช:** ุฌุฏูู feedback ุณุชูู `rating` ูุฏุงุฑุฏุ ุจุงุฏ ุงุฒ `score` ุงุณุชูุงุฏู ฺฉุฑุฏ
**ุฑุงู ุญู:** โ ูฺฉุณ ุดุฏ - ุชุบุฑ query ุจู ุงุณุชูุงุฏู ุงุฒ `score`

### โ 2. ุฌุฏูู contacts - ุณุชูู customer_id  
**ุฎุทุง:** `Unknown column 'customer_id' in 'where clause'`
**ุนูุช:** ุฌุฏูู contacts ุงุฒ `company_id` ุงุณุชูุงุฏู ูโฺฉูุฏ ูู `customer_id`
**ุฑุงู ุญู:** โ ูฺฉุณ ุดุฏ - ุชุบุฑ ุฏุฑ `app/api/tenant/customers/[id]/route.ts`

---

## ุชุบุฑุงุช ุงูุฌุงู ุดุฏู:

### 1. ูุงู: `app/api/tenant/monitoring/route.ts`
```typescript
// ูุจู:
SELECT rating, COUNT(*) as count FROM feedback

// ุจุนุฏ:
SELECT COALESCE(score, 0) as rating, COUNT(*) as count FROM feedback
```

### 2. ูุงู: `app/api/tenant/customers/[id]/route.ts`
```typescript
// ูุจู:
WHERE customer_id = ? AND tenant_key = ?

// ุจุนุฏ:
WHERE company_id = ? AND tenant_key = ?
```

### 3. ูุงู: `app/[tenant_key]/dashboard/system-monitoring/page.tsx`
- ุงุถุงูู ฺฉุฑุฏู ุฏฺฉูู "ุชูุงุด ูุฌุฏุฏ" ุฏุฑ ุญุงูุช ุนุฏู ูุฌูุฏ ุฏุงุฏู

---

## ูุชุงุฌ ุชุณุช:

### โ ุฏุงุฏูโูุง ููุฌูุฏ:
- ูุฑูุด ูุงูุงูู: 1 ูุงู (10 ูุฑูุด)
- ูุฑูุด ููุชฺฏ: 2 ููุชู
- ูุถุนุช ูพุฑุฏุงุฎุช: 2 ูุถุนุช (9 pending, 1 paid)
- ุจุฑุชุฑู ูุดุชุฑุงู: 10 ูุดุชุฑ
- ุฑุถุงุช ูุดุชุฑุงู: 0 (ูฺ ูุดุชุฑ ุจุง ุงูุชุงุฒ ุฑุถุงุช)
- ูุฑูุดูุฏฺฏุงู ุจุฑุชุฑ: ุฏุงุฏู ููุฌูุฏ

### โ๏ธ ุฏุงุฏูโูุง ูุงูุต:
- **ุฑุถุงุช ูุดุชุฑุงู:** ูฺ ูุดุชุฑ ุจุง `satisfaction_score` ูุฌูุฏ ูุฏุงุฑุฏ
- **ุจุงุฒุฎูุฑุฏูุง:** ุจุงุฏ ุจุฑุฑุณ ุดูุฏ ฺฉู ุฌุฏูู feedback ุฏุงุฏู ุฏุงุฑุฏ ุง ูู

---

## ุชูุตูโูุง:

### 1. ุงุถุงูู ฺฉุฑุฏู ุฏุงุฏู ููููู ุจุฑุง ุฑุถุงุช:
```sql
UPDATE customers 
SET satisfaction_score = FLOOR(3 + (RAND() * 2))
WHERE tenant_key = 'rabin' 
LIMIT 50;
```

### 2. ุจุฑุฑุณ ุฌุฏูู feedback:
```sql
SELECT COUNT(*) FROM feedback WHERE tenant_key = 'rabin';
```

### 3. ุงฺฏุฑ feedback ุฎุงู ุงุณุชุ ุงุถุงูู ฺฉุฑุฏู ุฏุงุฏู ููููู:
```sql
INSERT INTO feedback (id, tenant_key, customer_id, score, message, created_at)
SELECT 
  UUID(),
  'rabin',
  id,
  FLOOR(1 + (RAND() * 5)),
  'ุจุงุฒุฎูุฑุฏ ููููู',
  NOW()
FROM customers 
WHERE tenant_key = 'rabin'
LIMIT 20;
```

---

## ูุฑุงุญู ุชุณุช:

1. **ุฑุณุชุงุฑุช ุณุฑูุฑ Next.js**
   ```bash
   # Ctrl+C
   npm run dev
   ```

2. **ูุฑุงุฌุนู ุจู ุตูุญู ูุงูุชูุฑูฺฏ**
   ```
   http://localhost:3000/rabin/dashboard/system-monitoring
   ```

3. **ุจุฑุฑุณ Console ุจุฑุง ุฎุทุงูุง**
   - F12 โ Console
   - F12 โ Network โ ููุชุฑ: monitoring

4. **ุงฺฏุฑ "ุฏุงุฏูโุง ุงูุช ูุดุฏ" ููุงุด ุฏุงุฏู ุดุฏ:**
   - ฺฉูฺฉ ุฑู "ุชูุงุด ูุฌุฏุฏ"
   - ุจุฑุฑุณ Console ุจุฑุง ุฎุทุง ุฏูู
   - ุจุฑุฑุณ Network tab ุจุฑุง response

---

## ุฎุทุงูุง ุงุญุชูุงู:

### 1. ุฎุทุง 401 (Unauthorized)
**ุนูุช:** ูุดฺฉู authentication
**ุฑุงู ุญู:** 
- ูุงฺฏู ูุฌุฏุฏ
- ูพุงฺฉ ฺฉุฑุฏู cookie ูุง
- ุจุฑุฑุณ token ุฏุฑ localStorage

### 2. ุฎุทุง 500 (Internal Server Error)
**ุนูุช:** ูุดฺฉู ุฏุฑ query ูุง ุฏุชุงุจุณ
**ุฑุงู ุญู:**
- ุจุฑุฑุณ console ุณุฑูุฑ
- ุจุฑุฑุณ ุณุงุฎุชุงุฑ ุฌุฏุงูู
- ุงุฌุฑุง ุงุณฺฉุฑูพุช ุชุณุช: `node scripts/test-monitoring-api.cjs`

### 3. ุฏุงุฏูโุง ุงูุช ูุดุฏ (ุงูุง ุจุฏูู ุฎุทุง)
**ุนูุช:** response ุฎุงู ุง null
**ุฑุงู ุญู:**
- ุจุฑุฑุณ Network tab
- ุจุฑุฑุณ response.data
- ุงุถุงูู ฺฉุฑุฏู console.log ุฏุฑ ฺฉุฏ

---

## ูุถุนุช ููุง:

โ **API ูฺฉุณ ุดุฏ**
โ **ุฎุทุงูุง ุฏุชุงุจุณ ุจุฑุทุฑู ุดุฏ**
โ **ุตูุญู ุขูุงุฏู ููุงุด ุงุณุช**

โ๏ธ **ูุงุฒ ุจู ุฏุงุฏู ุจุดุชุฑ:**
- ุฑุถุงุช ูุดุชุฑุงู (satisfaction_score)
- ุจุงุฒุฎูุฑุฏูุง (feedback)

---

## ุฏุณุชูุฑุงุช ููุฏ:

### ุชุณุช API ุงุฒ ุทุฑู ุงุณฺฉุฑูพุช:
```bash
node scripts/test-monitoring-api.cjs
```

### ุจุฑุฑุณ ุณุงุฎุชุงุฑ ุฌุฏุงูู:
```bash
node scripts/check-feedback-structure.cjs
node scripts/check-contacts-structure.cjs
```

### ุงุถุงูู ฺฉุฑุฏู ุฏุงุฏู ููููู:
```bash
# ุงุฌุฑุง SQL ูุง ุจุงูุง ุฏุฑ MySQL
```

---

## ูุชุฌู:

ุตูุญู ูุงูุชูุฑูฺฏ ุขูุงุฏู ุงุณุช ู ุจุงุฏ ฺฉุงุฑ ฺฉูุฏ. ุงฺฏุฑ "ุฏุงุฏูโุง ุงูุช ูุดุฏ" ููุงุด ูโุฏูุฏ:
1. Console ุฑุง ฺฺฉ ฺฉูุฏ
2. Network tab ุฑุง ุจุฑุฑุณ ฺฉูุฏ  
3. ุงุณฺฉุฑูพุช ุชุณุช ุฑุง ุงุฌุฑุง ฺฉูุฏ
4. ุฏุงุฏู ููููู ุงุถุงูู ฺฉูุฏ

๐ **ุขูุงุฏู ุงุณุชูุงุฏู!**
