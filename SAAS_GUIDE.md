# ๐ฏ ุฑุงูููุง ฺฉุงูู ุณุณุชู Multi-Tenant SaaS

## ๐ ููุฑุณุช ูุทุงูุจ
1. [ูุนูุงุฑ ุณุณุชู](#ูุนูุงุฑ-ุณุณุชู)
2. [ุฑุงูโุงูุฏุงุฒ ุงููู](#ุฑุงูโุงูุฏุงุฒ-ุงููู)
3. [ูุญูู ุงุณุชูุงุฏู](#ูุญูู-ุงุณุชูุงุฏู)
4. [ูุฏุฑุช Tenants](#ูุฏุฑุช-tenants)
5. [ูุงฺฏู ู ุฏุณุชุฑุณ](#ูุงฺฏู-ู-ุฏุณุชุฑุณ)

---

## ๐๏ธ ูุนูุงุฑ ุณุณุชู

ุณุณุชู ุดูุง ุจู ุตูุฑุช Multi-Tenant ุทุฑุงุญ ุดุฏู:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              Master Database (saas_master)               โ
โ  - ูุฏุฑุช ุชูุงู tenants                                  โ
โ  - ุงุทูุงุนุงุช ุงุดุชุฑุงฺฉโูุง ู ูพููโูุง                          โ
โ  - Super Admin                                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                          โ
        โโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโ
        โ                 โ                 โ
โโโโโโโโโผโโโโโโโ  โโโโโโโโผโโโโโโโ  โโโโโโโโผโโโโโโโ
โ crm_system   โ  โ crm_tenant_ โ  โ crm_tenant_ โ
โ (rabin)      โ  โ  company2   โ  โ  company3   โ
โ              โ  โ             โ  โ             โ
โ ุฏุชุงุจุณ ุฌุฏุง  โ  โ ุฏุชุงุจุณ ุฌุฏุงโ  โ ุฏุชุงุจุณ ุฌุฏุงโ
โ ุจุฑุง ูุฑ ุดุฑฺฉุช โ  โ ุจุฑุง ูุฑ ุดุฑฺฉุชโ  โ ุจุฑุง ูุฑ ุดุฑฺฉุชโ
โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ
```

---

## ๐ ุฑุงูโุงูุฏุงุฒ ุงููู

### ูุฑุญูู 1: ุฑุงูโุงูุฏุงุฒ Master Database

```bash
node scripts/setup-master-database.cjs
```

ุงู ุงุณฺฉุฑูพุช:
- โ ุฏุชุงุจุณ `saas_master` ุฑุง ุงุฌุงุฏ ูโฺฉูุฏ
- โ Super Admin ุจุง ุงุทูุงุนุงุช ุฒุฑ ุงุฌุงุฏ ูโุดูุฏ:
  - **Username**: `Ahmadreza.avandi`
  - **Password**: `Ahmadreza.avandi`
  - **Email**: `ahmadrezaavandi@gmail.com`
- โ 3 ูพูู ูพุดโูุฑุถ ุงุฌุงุฏ ูโุดูุฏ:
  - **ูพุงู (basic)**: 500,000 ุชููุงู/ูุงู
  - **ุญุฑููโุง (professional)**: 1,500,000 ุชููุงู/ูุงู
  - **ุณุงุฒูุงู (enterprise)**: 5,000,000 ุชููุงู/ูุงู

### ูุฑุญูู 2: ุซุจุช ุฏุชุงุจุณ ููุฌูุฏ ุจู ุนููุงู ุงููู Tenant

```bash
node scripts/register-existing-tenant.cjs
```

ุงู ุงุณฺฉุฑูพุช ุฏุชุงุจุณ `crm_system` ููุฌูุฏ ุฑุง ุจู ุนููุงู tenant ุงูู (rabin) ุซุจุช ูโฺฉูุฏ.

---

## ๐ฎ ูุญูู ุงุณุชูุงุฏู

### 1๏ธโฃ ูุฑูุฏ ุจู ูพูู ูุฏุฑุช (Super Admin)

**URL**: `http://localhost:3000/secret-zone-789/login`

**ุงุทูุงุนุงุช ูุฑูุฏ**:
- Username: `Ahmadreza.avandi`
- Password: `Ahmadreza.avandi`

โ๏ธ **ููู**: ุงู ุฑูุฒ ุฑุง ุฏุฑ production ุญุชูุง ุชุบุฑ ุฏูุฏ!

### 2๏ธโฃ ูุฑูุฏ ุจู CRM (ูุฏุฑ ุดุฑฺฉุช)

**URL**: `http://localhost:3000/rabin/login`

**ุงุทูุงุนุงุช ูุฑูุฏ**:
- ุงุฒ ุงุทูุงุนุงุช ฺฉุงุฑุจุฑ ููุฌูุฏ ุฏุฑ ุฏุชุงุจุณ `crm_system` ุงุณุชูุงุฏู ฺฉูุฏ
- ุง ุงุฒ ูพูู admin ฺฉ ฺฉุงุฑุจุฑ ุฌุฏุฏ ุงุฌุงุฏ ฺฉูุฏ

---

## ๐ฅ ูุฏุฑุช Tenants

### ุงูุฒูุฏู Tenant ุฌุฏุฏ

1. ูุงุฑุฏ ูพูู admin ุดูุฏ: `http://localhost:3000/secret-zone-789/admin-panel`
2. ุฑู ุชุจ "ูุฏุฑุช ูุดุชุฑุงู" ฺฉูฺฉ ฺฉูุฏ
3. ุฏฺฉูู "+ ุงูุฒูุฏู Tenant ุฌุฏุฏ" ุฑุง ุจุฒูุฏ
4. ูุฑู ุฑุง ูพุฑ ฺฉูุฏ:
   - **Tenant Key**: ฺฉูุฏ ฺฉุชุง (ููุท ุญุฑูู ฺฉูฺฺฉุ ุงุนุฏุงุฏุ ุฎุท ุชุฑู)
   - **ูุงู ุดุฑฺฉุช**: ูุงู ฺฉุงูู ุดุฑฺฉุช
   - **ูุงู ูุฏุฑ**: ูุงู ูุฏุฑุนุงูู
   - **ุงูู ูุฏุฑ**: ุงูู ุจุฑุง ูุงฺฏู
   - **ุฑูุฒ ุนุจูุฑ ูุฏุฑ**: ุฑูุฒ ุนุจูุฑ ุจุฑุง ูุฑูุฏ (ุญุฏุงูู 8 ฺฉุงุฑุงฺฉุชุฑ)
   - **ูพูู ุงุดุชุฑุงฺฉ**: ุงูุชุฎุงุจ ูพูู
   - **ูุฏุช ุงุดุชุฑุงฺฉ**: 1ุ 3ุ 6 ุง 12 ูุงู

5. ุฑู "ุงุฌุงุฏ Tenant" ฺฉูฺฉ ฺฉูุฏ

### ูฺฺฏโูุง ุณุณุชู

โ **ุงุฒููุงุณูู ฺฉุงูู ุฏุงุฏูโูุง**: ูุฑ tenant ุฏุชุงุจุณ ุฌุฏุงฺฏุงูู ุฏุงุฑุฏ
โ **ูุฏุฑุช ุงุดุชุฑุงฺฉ**: ุชูุฏุฏุ ุชุนููุ ูุนุงูโุณุงุฒ
โ **ูพููโูุง ูุชููุน**: ูุงุจูุช ุชุนุฑู ูพููโูุง ูุฎุชูู
โ **ฺฏุฒุงุฑุดโฺฏุฑ**: ุขูุงุฑ ฺฉุงูู ุงุฒ tenants ู ุฏุฑุขูุฏ
โ **ุงููุช ุจุงูุง**: ุฑูุฒูฺฏุงุฑ ุงุทูุงุนุงุช ุญุณุงุณ

---

## ๐ ูุงฺฏู ู ุฏุณุชุฑุณ

### ุณุงุฎุชุงุฑ URL ูุง

```
# ูพูู ูุฏุฑุช (Super Admin)
http://localhost:3000/secret-zone-789/login
http://localhost:3000/secret-zone-789/admin-panel

# CRM ูุฑ ุดุฑฺฉุช (Tenant)
http://localhost:3000/{tenant_key}/login
http://localhost:3000/{tenant_key}/dashboard

# ูุซุงู ุจุฑุง ุดุฑฺฉุช ุฑุงุจู
http://localhost:3000/rabin/login
http://localhost:3000/rabin/dashboard
```

### ุณุทูุญ ุฏุณุชุฑุณ

1. **Super Admin**:
   - ุฏุณุชุฑุณ ุจู ูพูู ูุฏุฑุช
   - ูุฏุฑุช ุชูุงู tenants
   - ูุฏุฑุช ูพููโูุง
   - ูุดุงูุฏู ุขูุงุฑ ู ฺฏุฒุงุฑุดุงุช

2. **Tenant Admin (ูุฏุฑ ุดุฑฺฉุช)**:
   - ุฏุณุชุฑุณ ุจู CRM ุดุฑฺฉุช ุฎูุฏุด
   - ูุฏุฑุช ฺฉุงุฑุจุฑุงู ุดุฑฺฉุช
   - ูุฏุฑุช ูุดุชุฑุงู ู ูุฑูุด
   - ุงุณุชูุงุฏู ุงุฒ ุฏุณุชุงุฑ ุตูุช (ุจุณุชู ุจู ูพูู)

---

## ๐๏ธ ุงุณฺฉุฑูพุชโูุง ููุฏ

### ุชุนูุฑ ุฏุชุงุจุณ
```bash
node scripts/repair-database.cjs
```

### ุจุฑุฑุณ Super Admin
```bash
node scripts/check-super-admin.cjs
```

### ุชูุธู ูุฌุฏุฏ ุฑูุฒ Super Admin
```bash
node scripts/fix-super-admin-password.cjs
```

### ุงุฌุงุฏ Tenant ุฌุฏุฏ (ุงุฒ CLI)
```bash
node scripts/create-tenant-database.cjs [tenant_key] [company_name] [admin_email] [admin_name] [plan_key] [months]
```

ูุซุงู:
```bash
node scripts/create-tenant-database.cjs irankhodro "ุงุฑุงู ุฎูุฏุฑู" "admin@ikco.ir" "ูุฏุฑ ุณุณุชู" "enterprise" 12
```

---

## ๐ ูุฏุฑุช ูพููโูุง ุงุดุชุฑุงฺฉ

### ูุดุงูุฏู ูพููโูุง

1. ูุงุฑุฏ ูพูู admin ุดูุฏ
2. ุฑู ุชุจ "ูุฏุฑุช ุงุดุชุฑุงฺฉโูุง" ฺฉูฺฉ ฺฉูุฏ
3. ูุณุช ุชูุงู ูพููโูุง ููุงุด ุฏุงุฏู ูโุดูุฏ

### ุงูุฒูุฏู ูพูู ุฌุฏุฏ

1. ุฑู ุฏฺฉูู "+ ุงูุฒูุฏู ูพูู ุฌุฏุฏ" ฺฉูฺฉ ฺฉูุฏ
2. ุงุทูุงุนุงุช ูพูู ุฑุง ูุงุฑุฏ ฺฉูุฏ:
   - ฺฉูุฏ ูพูู (ฺฉุชุง)
   - ูุงู ูพูู
   - ููุช ูุงูุงูู ู ุณุงูุงูู
   - ูุญุฏูุฏุชโูุง (ฺฉุงุฑุจุฑุงูุ ูุดุชุฑุงูุ ูุถุง)
   - ูฺฺฏโูุง (ุฏุณุชุงุฑ ุตูุชุ ฺฏุฒุงุฑุดุงุช ูพุดุฑูุชูุ ู...)

### ุบุฑูุนุงู ฺฉุฑุฏู ูพูู

- ูพููโูุง ุบุฑูุนุงู ุจุฑุง tenants ุฌุฏุฏ ูุงุจู ุงูุชุฎุงุจ ูุณุชูุฏ
- tenants ูุนู ุชุญุช ุชุงุซุฑ ูุฑุงุฑ ููโฺฏุฑูุฏ

---

## ๐ ูุฏุฑุช Tenant

### ุชูุฏุฏ ุงุดุชุฑุงฺฉ

1. ูุงุฑุฏ ุตูุญู ุฌุฒุฆุงุช tenant ุดูุฏ
2. ุฑู ุฏฺฉูู "ุชูุฏุฏ ุงุดุชุฑุงฺฉ" ฺฉูฺฉ ฺฉูุฏ
3. ูพูู ู ูุฏุช ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ
4. ุชุงุฏ ฺฉูุฏ

### ุชุนูู Tenant

- Tenant ูุนูู ุดุฏู ููโุชูุงูุฏ ูุงุฑุฏ ุณุณุชู ุดูุฏ
- ุตูุญู "ุญุณุงุจ ูุนูู ุดุฏู" ููุงุด ุฏุงุฏู ูโุดูุฏ

### ุญุฐู Tenant (Soft Delete)

- Tenant ุจู ุตูุฑุช soft delete ุญุฐู ูโุดูุฏ
- ุฏุชุงุจุณ ุญุฐู ููโุดูุฏ
- ูุงุจู ุจุงุฒุงุจ ุงุณุช

---

## ๐ฏ ูฺฉุงุช ููู

### ุงููุช

โ๏ธ **ุญุชูุง ุงู ฺฉุงุฑูุง ุฑุง ุงูุฌุงู ุฏูุฏ**:

1. ุฑูุฒ Super Admin ุฑุง ุชุบุฑ ุฏูุฏ
2. `JWT_SECRET` ุฑุง ุฏุฑ production ุชุบุฑ ุฏูุฏ
3. `DB_ENCRYPTION_KEY` ุฑุง ุชุบุฑ ุฏูุฏ
4. ุงุฒ HTTPS ุงุณุชูุงุฏู ฺฉูุฏ
5. Backup ููุธู ุงุฒ ุฏุชุงุจุณโูุง ุจฺฏุฑุฏ

### Performance

- ูุฑ tenant connection pool ุฌุฏุงฺฏุงูู ุฏุงุฑุฏ
- ุงุทูุงุนุงุช tenant ุฏุฑ cache ูฺฏูุฏุงุฑ ูโุดูุฏ (5 ุฏููู)
- Middleware ุณุฑุน tenant ุฑุง ุดูุงุณุง ูโฺฉูุฏ

### Monitoring

- ุชูุงู ูุนุงูุชโูุง ููู log ูโุดููุฏ
- ุขูุงุฑ ฺฉุงูู ุฏุฑ ูพูู admin ููุฌูุฏ ุงุณุช
- ุงุดุชุฑุงฺฉโูุง ูููุถ ุดุฏู ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุดูุงุณุง ูโุดููุฏ

---

## ๐ ุนุจโุงุจ

### ูุดฺฉู: ููโุชูุงูู ูุงุฑุฏ ูพูู admin ุดูู

**ุฑุงูโุญู**:
```bash
node scripts/fix-super-admin-password.cjs
```

### ูุดฺฉู: ุฎุทุง ุฏุชุงุจุณ

**ุฑุงูโุญู**:
```bash
node scripts/repair-database.cjs
```

### ูุดฺฉู: Tenant ุงูุช ูุดุฏ

**ุจุฑุฑุณ ฺฉูุฏ**:
1. ุขุง tenant ุฏุฑ `saas_master.tenants` ุซุจุช ุดุฏูุ
2. ุขุง `is_deleted = false` ุงุณุชุ
3. ุขุง `subscription_status = 'active'` ุงุณุชุ

---

## ๐ ูพุดุชุจุงู

ุจุฑุง ุณูุงูุงุช ู ูุดฺฉูุงุช:
- Email: ahmadrezaavandi@gmail.com
- ูุณุชูุฏุงุช ฺฉุงูู ุฏุฑ ูพูุดู `docs/`

---

**ูุณุฎู**: 1.0.0  
**ุชุงุฑุฎ**: 2024  
**ุชูุณุนูโุฏููุฏู**: ุงุญูุฏุฑุถุง ุงููุฏ
