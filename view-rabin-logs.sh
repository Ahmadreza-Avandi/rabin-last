#!/bin/bash

# ๐ ูุดุงูุฏู ูุงฺฏโูุง ุฏุณุชุงุฑ ุตูุช ุฑุงุจู
# ุงู ุงุณฺฉุฑูพุช ูุงฺฏโูุง ุฑุงุจู ุฑุง ุงุฒ ูุงู ู Docker ููุงุด ูโุฏูุฏ

echo "๐ ูุดุงูุฏู ูุงฺฏโูุง ุฏุณุชุงุฑ ุตูุช ุฑุงุจู"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

# ุจุฑุฑุณ ุขุฑฺฏููุงูโูุง
MODE="${1:-both}"

case "$MODE" in
    "file"|"f")
        echo "๐ ููุงุด ูุงฺฏโูุง ูุงู..."
        echo ""
        
        # ูพุฏุง ฺฉุฑุฏู ุขุฎุฑู ูุงู ูุงฺฏ
        LATEST_LOG=$(ls -t "ุตุฏุง ุฑุงุจู/logs"/rabin-voice-*.log 2>/dev/null | head -1)
        
        if [ -z "$LATEST_LOG" ]; then
            echo "โ ูฺ ูุงู ูุงฺฏ ุงูุช ูุดุฏ!"
            echo "๐ก ุงุญุชูุงูุงู ุณุฑูุณ ูููุฒ ุงุฌุฑุง ูุดุฏู ุง ูุงฺฏ ุซุจุช ูุดุฏู ุงุณุช."
            exit 1
        fi
        
        echo "๐ ูุงู ูุงฺฏ: $LATEST_LOG"
        echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
        echo ""
        
        # ููุงุด ูุงฺฏ ุจุง tail -f
        tail -f "$LATEST_LOG"
        ;;
        
    "docker"|"d")
        echo "๐ณ ููุงุด ูุงฺฏโูุง Docker..."
        echo ""
        docker-compose logs -f rabin-voice
        ;;
        
    "both"|"b")
        echo "๐ ููุงุด ูุฑ ุฏู ููุน ูุงฺฏ..."
        echo ""
        echo "๐ณ ูุงฺฏโูุง Docker (ุขุฎุฑู 50 ุฎุท):"
        echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
        docker-compose logs --tail=50 rabin-voice
        
        echo ""
        echo "๐ ูุงฺฏโูุง ูุงู (ุขุฎุฑู 50 ุฎุท):"
        echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
        
        LATEST_LOG=$(ls -t "ุตุฏุง ุฑุงุจู/logs"/rabin-voice-*.log 2>/dev/null | head -1)
        
        if [ -z "$LATEST_LOG" ]; then
            echo "โ ูฺ ูุงู ูุงฺฏ ุงูุช ูุดุฏ!"
        else
            tail -50 "$LATEST_LOG"
        fi
        
        echo ""
        echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
        echo "๐ก ุจุฑุง ูุดุงูุฏู ูุงฺฏโูุง ุฒูุฏู:"
        echo "   ./view-rabin-logs.sh file    # ูุงฺฏโูุง ูุงู"
        echo "   ./view-rabin-logs.sh docker  # ูุงฺฏโูุง Docker"
        ;;
        
    "list"|"l")
        echo "๐ ูุณุช ูุงูโูุง ูุงฺฏ ููุฌูุฏ:"
        echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
        
        if [ -d "ุตุฏุง ุฑุงุจู/logs" ]; then
            ls -lh "ุตุฏุง ุฑุงุจู/logs"/*.log 2>/dev/null || echo "โ ูฺ ูุงู ูุงฺฏ ุงูุช ูุดุฏ!"
        else
            echo "โ ุฏุงุฑฺฉุชุฑ logs ุงูุช ูุดุฏ!"
        fi
        ;;
        
    "clear"|"c")
        echo "๐งน ูพุงฺฉ ฺฉุฑุฏู ูุงฺฏโูุง ูุฏู..."
        
        # ุญุฐู ูุงฺฏโูุง ูุฏูโุชุฑ ุงุฒ 7 ุฑูุฒ
        find "ุตุฏุง ุฑุงุจู/logs" -name "rabin-voice-*.log" -mtime +7 -delete 2>/dev/null
        
        echo "โ ูุงฺฏโูุง ูุฏูโุชุฑ ุงุฒ 7 ุฑูุฒ ูพุงฺฉ ุดุฏูุฏ"
        
        # ููุงุด ูุงฺฏโูุง ุจุงูโูุงูุฏู
        echo ""
        echo "๐ ูุงฺฏโูุง ุจุงูโูุงูุฏู:"
        ls -lh "ุตุฏุง ุฑุงุจู/logs"/*.log 2>/dev/null || echo "ูฺ ูุงู ูุงฺฏ ุจุงู ููุงูุฏู"
        ;;
        
    "help"|"h"|*)
        echo "ุงุณุชูุงุฏู:"
        echo "  ./view-rabin-logs.sh [MODE]"
        echo ""
        echo "ุญุงูุชโูุง ููุฌูุฏ:"
        echo "  both, b     - ููุงุด ูุฑ ุฏู ููุน ูุงฺฏ (ูพุดโูุฑุถ)"
        echo "  file, f     - ููุงุด ูุงฺฏโูุง ูุงู (ุฒูุฏู)"
        echo "  docker, d   - ููุงุด ูุงฺฏโูุง Docker (ุฒูุฏู)"
        echo "  list, l     - ูุณุช ูุงูโูุง ูุงฺฏ"
        echo "  clear, c    - ูพุงฺฉ ฺฉุฑุฏู ูุงฺฏโูุง ูุฏู"
        echo "  help, h     - ููุงุด ุงู ุฑุงูููุง"
        echo ""
        echo "ูุซุงูโูุง:"
        echo "  ./view-rabin-logs.sh          # ููุงุด ูุฑ ุฏู ููุน ูุงฺฏ"
        echo "  ./view-rabin-logs.sh file     # ููุงุด ูุงฺฏโูุง ูุงู"
        echo "  ./view-rabin-logs.sh docker   # ููุงุด ูุงฺฏโูุง Docker"
        echo "  ./view-rabin-logs.sh list     # ูุณุช ูุงูโูุง ูุงฺฏ"
        ;;
esac